@startuml
left to right direction
skinparam component style uml1

actor "User" as user
cloud "Google Cloud Platform" {
    
    component "Cloud Load Balancer\n(Ingress Static IP)" as ingress
    
    package "Kubernetes Cluster (GKE)" {
        component "Service\n(NodePort)" as service
        
        node "Pod" {
            component "Flask App\n(Container)" as flask
            component "Cloud SQL Proxy\n" as proxy
            
            note right of proxy
              (Sidecar Container)
              Listens on localhost:5432
            end note
        }
    }
    
    database "Cloud SQL\n(PostgreSQL)" as db
    component "Secret Manager" as secrets
}

user -> ingress : 1. HTTP Request
ingress -> service : 2. Route traffic
service -> flask : 3. Forward to App
flask -> proxy : 4. SQL Query (connect to localhost)
proxy <-> db : 5. Encrypted Tunnel (Private IP)

flask ..> secrets : "Env Vars (K8s Secrets)"

@enduml